/* Author: Denis Podgurskii */
'use strict';

////////////////////////////////////
$(document).ready(function () {

    $('#settings_save').click(function () {
        var forItem = $("a.item.active").attr("forItem");
        switch (forItem) {
            case "general":
                var $form = $('#general_form'),
                    values = $form.form('get values');
                $.each(values, function (index, value) {
                    if (index == 'max_requests_per_tab')
                        values[index] = Number.isInteger(parseInt(value)) ? parseInt(value) : bgProxy.settings.main.general.max_requests_per_tab;
                    else if (index == 'max_tabs')
                        values[index] = Number.isInteger(parseInt(value)) ? parseInt(value) : bgProxy.settings.main.general.max_tabs;
                    else
                        values[index] = value == 'on' ? true : false;
                });
                bgProxy.updateSettings('main.general', values);
                break;
            case "proxy":
                var $form = $('#proxy_form'),
                    values = $form.form('get values');
                bgProxy.updateSettings('main.proxy', values);
                break;
            case "headers":
                var $form = $('#headers_form'),
                    values = $form.form('get values');
                bgProxy.updateSettings('main.headers', values);
                break;
        }

        $(".modal").fadeIn("slow").delay(2000).fadeOut();

    });

    $('#settings_reset').click(function () {
        bgProxy.resetSettings();
        setTimeout(function () {
            $(document).trigger("initForms", null);
        }, 100);
        $(".modal").fadeIn("slow").delay(2000).fadeOut();
    });

    $(document).trigger("initForms", null);
});


$(document).on("initForms", function (e) {
    $('#general_form').form('set values', bgProxy.settings.main.general);
    $('#proxy_form').form('set values', bgProxy.settings.main.proxy);
    $('#headers_form').form('set values', bgProxy.settings.main.headers);
});

$(document).on("saveForms", function (e) {

});