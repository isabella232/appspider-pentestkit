/* Author: Denis Podgurskii */
import { ptk_controller_settings } from "./controller/settings.js"
const controller = new ptk_controller_settings()

jQuery(function () {

    $('#settings_save').on('click', function () {
        let forItem = $("a.item.active").attr("forItem")
        let $form = $('#' + forItem + '_form'), values = $form.form('get values')
        switch (forItem) {
            case "general":
                $.each(values, function (index, value) {
                    if (index == 'max_requests_per_tab')
                        values[index] = Number.isInteger(parseInt(value)) ? parseInt(value) : controller.main.general.max_requests_per_tab
                    else if (index == 'max_tabs')
                        values[index] = Number.isInteger(parseInt(value)) ? parseInt(value) : controller.main.general.max_tabs
                    else
                        values[index] = value == 'on' ? true : false
                })
                controller.save('main.general', values)
                break
            case "proxy":
                controller.save('main.proxy', values)
                break
            case "headers":
                controller.save('main.headers', values)
                break
        }
        $(".modal").fadeIn("slow").delay(2000).fadeOut()

    })

    $('#settings_reset').on('click', function () {
        controller.reset().then(function (s) {
            $(document).trigger("init_forms", s)
            $(".modal").fadeIn("slow").delay(2000).fadeOut()
        })
    })
    controller.restore().then(function (s) {
        $(document).trigger("init_forms", s)
    })
})


$(document).on("init_forms", function (e, s) {
    $('#general_form').form('set values', s.main.general)
    $('#proxy_form').form('set values', s.main.proxy)
    $('#headers_form').form('set values', s.main.headers)
})
