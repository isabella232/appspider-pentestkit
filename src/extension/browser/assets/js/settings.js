/* Author: Denis Podgurskii */
import { ptk_controller_settings } from "./controller/settings.js"
var controller = new ptk_controller_settings()

jQuery(function () {

    $('#settings_save').on('click', function () {
        var forItem = $("a.item.active").attr("forItem")
        switch (forItem) {
            case "general":
                var $form = $('#general_form'),
                    values = $form.form('get values')
                $.each(values, function (index, value) {
                    if (index == 'max_requests_per_tab')
                        values[index] = Number.isInteger(parseInt(value)) ? parseInt(value) : ptk_app.settings.main.general.max_requests_per_tab
                    else if (index == 'max_tabs')
                        values[index] = Number.isInteger(parseInt(value)) ? parseInt(value) : ptk_app.settings.main.general.max_tabs
                    else
                        values[index] = value == 'on' ? true : false
                })
                controller.save('main.general', values)
                break
            case "proxy":
                var $form = $('#proxy_form'),
                    values = $form.form('get values')
                controller.save('main.proxy', values)
                break
            case "headers":
                var $form = $('#headers_form'),
                    values = $form.form('get values')
                controller.save('main.headers', values)
                break
        }

        $(".modal").fadeIn("slow").delay(2000).fadeOut()

    })

    $('#settings_reset').on('click', function () {
        controller.reset()
        setTimeout(function () {
            $(document).trigger("initForms", null)
        }, 100)
        $(".modal").fadeIn("slow").delay(2000).fadeOut()
    })

    $(document).trigger("initForms", null)
})


$(document).on("initForms", function (e) {
    var s = controller.restore()
    $('#general_form').form('set values', s.main.general)
    $('#proxy_form').form('set values', s.main.proxy)
    $('#headers_form').form('set values', s.main.headers)
})
