/* Author: Denis Podgurskii */

var ptk_app = browser.extension.getBackgroundPage().ptk_app

function bindTable(id, params) {
    params.paging = false
    params.ordering = false
    params.info = false
    params.searching = true
    params.sorting = false
    params.dom = 'lrtp'

    var table
    if ($.fn.dataTable.isDataTable(id)) {
        table = $(id).DataTable()
        table.clear().rows.add(params.data).draw()
    } else {
        table = $(id).DataTable(params)
    }
    return table
}

jQuery(function () {
    //Main menu
    $('#mainMenuWrapper').append(
        `<div class="ui small inverted borderless menu" style="height:12px">
            <img src="assets/images/hacker_w1.png" id="ptkicon" title="Penetration Testing Kit">
            <div class="ui container" id="mainMenu">
                <a class="item" href="index.html">Dashboard</a>
                <a class="item" href="requestbuilder.html">Request Builder</a>
                <a class="item" href="macro.html">Macro Recorder</a>
                <a class="item" href="traffic.html">Traffic Recorder</a>
                <a class="item" href="swagger.html">Swagger utility</a>
                <div class="ui dropdown item right floating">
                    <div class="" style="margin-right: -15px;"><i title="User Guide" class="question circle outline inverted big icon"></i></div>
                    <div class="menu" style="margin-top: 0px !important; min-height: 90px;">
                        <!--a class="item disabled" href="headers.html">Headers manager(v.2)</a -->
                        <!--a class="item disabled" href="reqexbuilder.html">Regex Builder (v.2)</a-->
                        <a class="item" href="#" id="opennewwindow">Open in new window</a>
                        <a class="item" href="#" id="opensettings">Settings</a>
                        <div class="ui fitted divider"></div>
                        <div class="header"></div>
                        <a class="item" href="/browser/user_guide.html">User Guide</a>
                        <a class="item" href="/browser/release_notes.html">Release notes</a>
                    </div>
                </div>
                <!--a href="user_guide.html"><i title="User Guide" class="question right floated circle outline inverted big icon" style="padding-top: 8px;"></i></a-->
            </div>
            <div style="position: fixed; bottom: 0px; left:5px; width:40px"><a href="https://www.youtube.com/channel/UCbEcTounPkV1aitE1egXfqw/"  target="_blank" ><img src="assets/images/youtube.png"  title="Watch the PTK youtube channel"></a></div>
        </div>`


    )

    $('#mainMenu a.item').each(function (i, obj) {
        if (window.location.pathname.indexOf($(obj).attr('href')) > 0)
            $(obj).addClass('active').siblings().removeClass('active')
    });

    //Submenu all pages
    $('.ui.menu a.item').on('click', function () {
        $(this).addClass('active').siblings().removeClass('active')
        var forItem = $(this).attr('forItem')
        $('.ui.menu a.item').each(function (i, obj) {
            var f = $(obj).attr('forItem')
            if (f != forItem) $('#' + f).hide("")
        })
        $('#' + forItem).show("")
    })

    //Settings page
    $('#opensettings').on('click', function () {
        browser.runtime.openOptionsPage()
    })

    //New window
    $('#opennewwindow').on('click', function () {
        ptk_app.openInNewWindow();
    });

    //Semantic UI 
    $('.ui.dropdown').dropdown({ on: 'click' })
    $('.ui.checkbox').checkbox()
    $('.dropdown.allowAdditions')
        .dropdown({
            allowAdditions: true
        })
})