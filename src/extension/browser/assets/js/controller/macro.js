/* Author: Denis Podgurskii */

export var macroController = {

    start: function (cleanCookie, values) {
        ptk_app.recorder.startMacro(cleanCookie, values['url'])
    },

    export: function () {
        if (ptk_app.recorder.recording.items.length > 0) {
            var values = this.$form.form('get values')
            var res = ptk_app.exporter.renderXml(ptk_app.recorder.items, values)
            this.$form.form('set value', 'recording_output', res)
            this.editor.setOption("mode", "application/xml")
            this.editor.setValue(res)
            ptk_app.recorder.savedMacro = res

            this.checkFrames()

            $('.exportType').text(values['event_type'])
            $('.exportType').fadeIn()
            $('.exportType').addClass("display")
            setTimeout(function (evt) {
                $('.exportType').fadeOut("slow", function () {
                    $('.exportType').removeClass("display")
                    $('.exportType').text()
                })
            }, 3500)

        }
    },
    checkFrames: function () {
        var values = this.$form.form('get values')
        var res = ptk_app.Exporter.renderXml(ptk_app.recorder.items, values)
        var xml = this.editor.getValue()

        if (ptk_app.recorder.iFramesDetected || xml.includes('<![CDATA[xpath=//IFRAME[')) {
            $('.iframeSign').addClass("display")
        } else {
            $('.iframeSign').removeClass("display")
        }

        if (xml != "" && xml.replace(/[^a-zA-Z]/g, "").localeCompare(res.replace(/[^a-zA-Z]/g, "")) != 0) {
            $('.savedMacro').addClass("display")
        } else {
            $('.savedMacro').removeClass("display")
        }
    }


}

